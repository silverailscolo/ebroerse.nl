<div id="{{ include.albumname }}">
  <!-- div autogenerated from folder {{ include.albumname }} of imgs, based on Jimmy Xiao -->
  <!-- uses _plugins/Jekyll-ExifTag.rb and exif .node_module , changed to exif gem + getexiftag (my own plugin)-->
  {% for image in site.static_files %}{% if image.path contains 'img' and image.path contains include.albumname %}
  {% unless image.name contains '.webp' or image.name contains '.xmp' %}
  {% if include.albumname contains 'covers' %}
  {% comment %} *covers is for books/records/enginepics etc stored as folders with same name as img.name, no
  lightGallery support used in front matter, links directly to item page index.html in subfolder of img name base {%
  endcomment %}
  <a href="{{ image.name | replace: '.jpg', '/' | replace: '.png', '/'}}" class="image-ref">
    <img
      src="{{ site.baseurl }}/thumbnails{{ image.path | replace: 'assets/img-noresample/', ''| replace: 'assets/img/', ''}}"
      alt="{{ image.name }}"
    />
  </a>
  {% else %}
  <a href="{{ site.baseurl }}{{ image.path }}" class="image-ref"
     data-sub-html="{% getexiftag image_description, , {{ image.path }} %}, {% getexiftag copyright, , {{ image.path }} %}">
    <img src="{{ site.baseurl }}/thumbnails{{ image.path | replace: 'assets/img-noresample/', ''| replace: 'assets/img/', ''}}" alt="{{ my_title }}" />
  </a>
  {% comment %}Some tags return invalid UTF-8 ecoding, so I tried to filter, but this is included in the path
  | encode(Encoding.find('UTF-8'), {invalid: :replace, undef: :replace, replace: ''}){% endcomment %}
  {% endif %}{% endunless %}{% endif %}{% endfor %}
</div>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    lightGallery(document.getElementById("{{ include.albumname }}"), {
      plugins: [lgZoom, lgThumbnail, lgAutoplay, lgFullscreen],
      speed: 500,
      thumbnails: true,
      thumbWidth: 60,
      thumbHeight: "40px",
      thumbMargin: 4,
      showMaximizeIcon: true,
      mobileSettings: {
        controls: false,
        showCloseIcon: true,
        download: false,
        rotate: false,
        thumbnail: false,
      },
    });

    // init isotope
    var $grid = $("#{{ include.albumname }}");
    $grid.isotope({
      percentPosition: true,
      itemSelector: ".image-ref",
      layoutMode: "masonry",
      gutter: 5,
    });

    // layout Isotope after each image loads
    $grid.imagesLoaded().progress(function () {
      $grid.masonry();
    });
  });
</script>
