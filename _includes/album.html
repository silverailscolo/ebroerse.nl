<div id="{{ include.albumname }}">
<!-- div autogenerated from folder {{ include.albumname }} of imgs, based on Jimmy Xiao -->
<!-- uses _plugins/Jekyll-ExifTag.rb and exiftool gem -->
<!-- only works in primary/non-polyglot language TODO fix -->
<!-- polyglot gem returns static_files empty unless default language. Don't wish redundant asset copies -->
{% for image in site.static_files %}
  {% assign ip = image.path %}
  <!-- {{ ip }} -->
  {% if ip contains 'img' and ip contains include.albumname %}
  {% unless image.extname == '.webp' or image.extname == '.xmp' %}

  {% assign rt = image.path | slice: 0, 7 %}
  {% comment %} polyglot secondary language has messed up site.static_files, 1st path starts without / as a relative url
  won't work {% endcomment %}
  {% if rt == 'assets/' %}
<!--  Before: {{ ip }} (rt = {{ rt }})-->
  {% assign ip = ip | prepend: '/' %}
<!--  After: {{ ip }}-->
  {% endif %}
  {% if rt == '/assets' or rt == 'assets/' %}
<!--  Use: {{ ip }} (rt = {{ rt }})-->

  {% if include.albumname contains 'covers' %}
  {% comment %} *covers is for books/records/enginepics etc stored as folders with same name as img.name, no
  lightGallery support used in front matter, links directly to item page index.html in subfolder of img name base
  {% endcomment %}
  <a href="{{ image.name | replace: '.jpg', '/' | replace: '.png', '/'}}" class="image-ref">
    <img
      src="{{ site.baseurl }}/assets/thumbnails{{ ip | replace: 'assets/img-noresample/', ''| replace: 'assets/img/', ''}}"
      alt="{{ image.name }}"
    />
  </a>
  {% else %}
{% comment %} Valid exiftag.exiftool tags: EXIF: image_description; IPTC: headline, caption-abstract; XMP: Description, Comment; All:
  copyright (case-insensitive) {% endcomment %}
<a href="{{ site.baseurl }}{{ ip }}" class="image-ref"
   data-sub-html="{% exiftag caption-cascade, , {{ ip }} %} {% exiftag copyright-cascade, , {{ ip }} %}">
   <img
           src="{{ site.baseurl }}/assets/thumbnails{{ ip | replace: 'assets/img-noresample/', ''| replace: 'assets/img/', ''}}"
        alt="{% exiftag image_description, , {{ ip }} %}" />
</a>
  {% comment %}Some tags return invalid UTF-8 encoding, encoding is enforced in exiftag.rb plugin {% endcomment %}
  {% endif %}
  {% comment %}
  {% else %}Dropped: {{ ip }} (rt = {{ rt }})
  {% endcomment %}
  {% endif %}
  {% endunless %}{% endif %}
{% endfor %}
</div>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    lightGallery(document.getElementById("{{ include.albumname }}"), {
      plugins: [lgZoom, lgThumbnail, lgAutoplay],
      closable: true,
      selector: ".image-ref",
      slideDelay: 100,
      speed: 500,
      thumbnails: true,
      thumbWidth: 60,
      thumbHeight: "40px",
      thumbMargin: 4,
      mobileSettings: {
        controls: false,
        showCloseIcon: true,
        download: false,
        rotate: false,
        thumbnail: false,
      },
    });

    // init isotope
    var $grid = $("#{{ include.albumname }}");
    $grid.isotope({
      percentPosition: true,
      itemSelector: ".image-ref",
      layoutMode: "masonry",
      gutter: 5,
    });

    // layout Isotope after each image loads
    $grid.imagesLoaded().progress(function () {
      $grid.masonry();
    });
  });
</script>
